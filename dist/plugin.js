"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),storageKey="<%= options.storageKey %>",vuexNamespace="<%= options.vuexNamespace %>",loginUrl="<%= options.loginUrl %>",refreshTokenKey="<%= options.refreshTokenKey %>",refreshUrl="<%= options.refreshUrl %>",state=function(){return{refreshInterval:null}},mutations={refreshInterval:function refreshInterval(a,b){a.refreshInterval=b,a.refreshInterval||clearInterval(a.refreshInterval)}},actions={startRefreshInterval:function startRefreshInterval(a,b){var c=a.dispatch,d=a.commit;this.$auth.$storage.setUniversal(storageKey,b[refreshTokenKey]),this.$auth.$storage.setUniversal(storageKey+"_expiration",b[refreshTokenKey]);var e=function(){c("attemptRefresh")["catch"](function(){c("stopRefreshInterval")})};setTimeout(function(){return d("refreshInterval",setInterval(e,1200000))},1200000)},stopRefreshInterval:function stopRefreshInterval(a){var b=a.commit;b("refreshInterval",null)},attemptRefresh:function(){var a=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function a(){var b;return _regenerator["default"].wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b=this.$auth.$storage.getUniversal(storageKey),b){a.next=3;break}return a.abrupt("return");case 3:this.$auth.login({url:refreshUrl,data:(0,_defineProperty2["default"])({},refreshTokenKey,b)});case 4:case"end":return a.stop();}},a,this)}));return function attemptRefresh(){return a.apply(this,arguments)}}()},storeModule={state:state,actions:actions,mutations:mutations,namespaced:!0},_default=function(a){var b=a.$axios,c=a.store;c.registerModule(vuexNamespace,storeModule,{preserveState:!!c.state[vuexNamespace]}),b.interceptors.response.use(function(a){return-1!==a.config.url.indexOf(loginUrl)&&c.dispatch(vuexNamespace+"/startRefreshInterval",a.data),a})};exports["default"]=_default;